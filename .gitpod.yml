# Only /workspace folder is preserved on restarts, therefore both the Python
# virtual environment and pre-commit caches have to be installed there
image:
    file: .gitpod.Dockerfile
tasks:
    - name: Setup venv and dev tools
      init: |
          mkdir .vscode
          cp .gitpod/.vscode/* .vscode/
          python -m venv .venv
          source .venv/bin/activate
          pip install --upgrade pip setuptools wheel
          pip install -r requirements-dev.txt
          pre-commit install --install-hooks
          git clone --recursive git@github.com:GridTools/serialbox.git #DL: TODO remove
          CC=`which gcc` CXX=`which g++` pip install serialbox/src/serialbox-python #DL: TODO remove
          deactivate
      command: source .venv/bin/activate
      env:
          PIP_SRC: _external_src
          PRE_COMMIT_HOME: /workspace/.caches/pre-commit
vscode:
    extensions:
        - ms-python.python
        - ms-toolsai.jupyter
        - ms-toolsai.jupyter-keymap
        - ms-toolsai.jupyter-renderers
        - genuitecllc.codetogether

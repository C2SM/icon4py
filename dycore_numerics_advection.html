

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dycore numerical documentation (velocity advection) &mdash; icon4py-atmosphere-dycore  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=7e16d7a6" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>window.MathJax = {"chtml": {"displayAlign": "left", "displayIndent": "1em"}, "tex": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "macros": {"superscriptsize": "{\\scriptscriptstyle}", "subscriptsize": "{\\scriptscriptstyle}", "timecolor": ["{\\color{teal}{#1}}", 1], "vertcolor": ["{\\color{YellowOrange}{#1}}", 1], "horicolor": ["{\\color{RedViolet}{#1}}", 1], "timestep": ["{{\\subscriptsize{\\timecolor{#1}}}}", 1], "vertlevel": ["{{\\subscriptsize{\\vertcolor{#1}}}}", 1], "horipoint": ["{{\\subscriptsize{\\horicolor{#1}}}}", 1], "dif": "{\\mathrm{d}}", "Dt": "{{\\Delta t}}", "Dz": ["{{\\Delta z}_\\vertlevel{#1}}", 1], "divhori": ["{\\vec{\\nabla}\\!_h\\cdot\\left(#1\\right)}", 1], "Gradn": "{{{\\Large{\\Delta}}}}", "ddt": ["{\\frac{\\dif #1}{\\dif t}}", 1], "ddz": ["{\\frac{\\dif #1}{\\dif z}}", 1], "ddxn": ["{\\frac{\\dif #1}{\\dif n}}", 1], "ddxt": ["{\\frac{\\dif #1}{\\dif t}}", 1], "pdt": ["{\\frac{\\partial #1}{\\partial t}}", 1], "pdz": ["{\\frac{\\partial #1}{\\partial z}}", 1], "pdzz": ["{\\frac{\\partial^2 #1}{\\partial z^2}}", 1], "pdxn": ["{\\frac{\\partial #1}{\\partial n}}", 1], "pdxt": ["{\\frac{\\partial #1}{\\partial t}}", 1], "variable": ["{{{#1}_{\\horipoint{#3}\\,\\vertlevel{#4}}^{\\timestep{#2}}}}", 4], "vn": ["{             \\variable{v_n                                  }{#1}{#2}{#3}}", 3], "vt": ["{             \\variable{v_t                                  }{#1}{#2}{#3}}", 3], "vh": ["{             \\variable{\\vec{v_h}                            }{#1}{#2}{#3}}", 3], "w": ["{              \\variable{w                                    }{#1}{#2}{#3}}", 3], "wcc": ["{            \\variable{w_{\\text{cc}}                        }{#1}{#2}{#3}}", 3], "kinehori": ["{       \\variable{K_h                                  }{#1}{#2}{#3}}", 3], "advvn": ["{          \\variable{\\text{adv}(v_n)                      }{#1}{#2}{#3}}", 3], "vortvert": ["{       \\variable{\\zeta                                }{#1}{#2}{#3}}", 3], "density": ["{        \\variable{\\rho                                 }{#1}{#2}{#3}}", 3], "pres": ["{           \\variable{P                                    }{#1}{#2}{#3}}", 3], "vtemp": ["{          \\variable{T_v                                  }{#1}{#2}{#3}}", 3], "vtempprime": ["{     \\variable{T_v'                                 }{#1}{#2}{#3}}", 3], "vpotemp": ["{        \\variable{\\theta_v                             }{#1}{#2}{#3}}", 3], "vpotempprime": ["{   \\variable{\\theta_v'                            }{#1}{#2}{#3}}", 3], "exner": ["{          \\variable{\\pi                                  }{#1}{#2}{#3}}", 3], "exnerprime": ["{     \\variable{\\pi'                                 }{#1}{#2}{#3}}", 3], "exnerprimegradh": ["{\\variable{\\pdxn{\\exnerprime{#1}{}{}}           }{  }{#2}{#3}}", 3], "exnerprimedz": ["{   \\variable{\\pdz{\\exnerprime{#1}{}{}}            }{  }{#2}{#3}}", 3], "exnerprimedzz": ["{  \\variable{\\frac{1}{2}\\pdzz{\\exnerprime{#1}{}{}}}{  }{#2}{#3}}", 3], "variableXK": ["{{{#1}_{\\horipoint{#2}\\,\\vertlevel{#3}}}}", 3], "presref": ["{   \\variableXK{P_0                                                            }{#1}{#2}}", 2], "vpotempref": ["{\\variableXK{\\theta_{v0}                                                    }{#1}{#2}}", 2], "exnerref": ["{  \\variableXK{\\pi_0                                                          }{#1}{#2}}", 2], "dexrefdz": ["{  \\variableXK{\\frac{1}{\\Dz{}\\vpotempref{}{}}\\ddz{\\exnerref{}{}}              }{#1}{#2}}", 2], "ddexrefdzz": ["{\\variableXK{\\ddz{}\\left(\\frac{1}{\\vpotempref{}{}}\\ddz{\\exnerref{}{}}\\right)}{#1}{#2}}", 2], "variableX": ["{{{#1}_{\\horipoint{#2}}}}", 2], "coriolis": ["{    \\variableX{f                                                                 }{#1}}", 1], "exnhydrocorr": ["{\\variableX{\\frac{g}{\\cpd \\vpotemp{\\color{black}{2}}{}{}}\\pdxn{\\vpotemp{}{}{}}}{#1}}", 1], "cpd": "{c_{pd}}", "cvd": "{c_{vd}}", "nlev": "{{\\texttt{num_lev}}}", "nflatlev": "{{\\texttt{flat_lev}}}", "nflatgradp": "{{\\texttt{flat_gradp_lev}}}", "n": "{{\\timecolor{n}}}", "ntilde": "{{\\timecolor{\\tilde{\\n}}}}", "e": "{{\\horicolor{e}}}", "offProv": ["{\\horicolor{#1}}", 1], "Wrbf": "{\\overset{\\scriptscriptstyle{\\text{rbf}}}{\\chi}}", "Wlev": "{\\overset{\\scriptscriptstyle{\\text{lev}}}{\\chi}}", "Whor": "{\\overset{\\scriptscriptstyle{\\text{hor}}}{\\chi}}", "Wedge": "{\\frac{1}{d_{12}}}", "Cgrad": "{\\overset{\\scriptscriptstyle{\\text{grad}}}{\\chi}}", "Crot": "{\\overset{\\scriptscriptstyle{\\text{rot}}}{\\chi}}", "dzgradp": "{(h^* - h_k)}", "WtimeExner": "{\\gamma}", "WtimeVWind": "{\\eta}", "IDXpg": "{\\overset{\\scriptstyle{\\partial \\pi / \\partial n}}{\\text{IDX}}}", "sum": "{\\Large{\\Sigma}}", "k": "{{\\vertcolor{k}}}", "c": "{{\\horicolor{c}}}", "v": "{{\\horicolor{v}}}"}}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dycore numerical documentation (solve nonhydro)" href="dycore_numerics_nonhydro.html" />
    <link rel="prev" title="Dycore numerical documentation" href="dycore_numerics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            icon4py-atmosphere-dycore
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Numerical documentation:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="dycore_numerics.html">Dycore numerical documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Dycore numerical documentation (velocity advection)</a></li>
<li class="toctree-l2"><a class="reference internal" href="dycore_numerics_nonhydro.html">Dycore numerical documentation (solve nonhydro)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help pages:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="symbols_description.html">Description of symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="_source/offset_providers.html">Offset providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="scidoc_processor.html">Scidoc processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="feedback.html">Feedback</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">icon4py-atmosphere-dycore</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="dycore_numerics.html">Dycore numerical documentation</a></li>
      <li class="breadcrumb-item active">Dycore numerical documentation (velocity advection)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dycore_numerics_advection.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dycore-numerical-documentation-velocity-advection">
<h1>Dycore numerical documentation (velocity advection)<a class="headerlink" href="#dycore-numerical-documentation-velocity-advection" title="Link to this heading"></a></h1>
<p>This page documents the advection part of the dycore.</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-prename descclassname"><span class="pre">VelocityAdvection.</span></span><span class="sig-name descname"><span class="pre">run_predictor_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">vn_only:</span> <span class="pre">bool,</span> <span class="pre">diagnostic_state:</span> <span class="pre">~icon4py.model.atmosphere.dycore.dycore_states.DiagnosticStateNonHydro,</span> <span class="pre">prognostic_state:</span> <span class="pre">~icon4py.model.common.states.prognostic_state.PrognosticState,</span> <span class="pre">z_w_concorr_me:</span> <span class="pre">~gt4py.next.common.Field[~gt4py.next.common.Dims[Dimension(value='Edge',</span> <span class="pre">kind=&lt;DimensionKind.HORIZONTAL:</span> <span class="pre">'horizontal'&gt;),</span> <span class="pre">Dimension(value='K',</span> <span class="pre">kind=&lt;DimensionKind.VERTICAL:</span> <span class="pre">'vertical'&gt;)],</span> <span class="pre">float],</span> <span class="pre">z_kin_hor_e:</span> <span class="pre">~gt4py.next.common.Field[~gt4py.next.common.Dims[Dimension(value='Edge',</span> <span class="pre">kind=&lt;DimensionKind.HORIZONTAL:</span> <span class="pre">'horizontal'&gt;),</span> <span class="pre">Dimension(value='K',</span> <span class="pre">kind=&lt;DimensionKind.VERTICAL:</span> <span class="pre">'vertical'&gt;)],</span> <span class="pre">float],</span> <span class="pre">z_vt_ie:</span> <span class="pre">~gt4py.next.common.Field[~gt4py.next.common.Dims[Dimension(value='Edge',</span> <span class="pre">kind=&lt;DimensionKind.HORIZONTAL:</span> <span class="pre">'horizontal'&gt;),</span> <span class="pre">Dimension(value='K',</span> <span class="pre">kind=&lt;DimensionKind.VERTICAL:</span> <span class="pre">'vertical'&gt;)],</span> <span class="pre">float],</span> <span class="pre">dtime:</span> <span class="pre">float,</span> <span class="pre">cell_areas:</span> <span class="pre">~gt4py.next.common.Field[~gt4py.next.common.Dims[Dimension(value='Cell',</span> <span class="pre">kind=&lt;DimensionKind.HORIZONTAL:</span> <span class="pre">'horizontal'&gt;)],</span> <span class="pre">float]</span></em><span class="sig-paren">)</span></dt>
<dd><section id="self-mo-math-divrot-rot-vertex-ri-dsl">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._mo_math_divrot_rot_vertex_ri_dsl</span></code><a class="headerlink" href="#self-mo-math-divrot-rot-vertex-ri-dsl" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>zeta: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Vertex,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\vortvert{\n}{\v}{\k} = \sum_{\offProv{v2e}} \Crot \vn{\n}{\e}{\k}
\]</div>

Compute the vorticity on vertices using the discrete Stokes
theorem (eq. 5 in <a class="reference external" href="https://doi.org/10.1175/MWR2986.1">Bonaventura_and_Ringler_2005</a>).</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Crot\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.interpolation_state.}}}\)</span>geofac_rot: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Vertex,</span> <span class="pre">V2E],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\vn{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{prognostic_state.}}}\)</span>vn: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
</ul>
</details><details class="summary-offset-providers">
<summary>Offset providers</summary><img alt="v2e" class="offset-provider-img" src="_images/offsetProvider_v2e.png" />
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_mo_math_divrot_rot_vertex_ri_dsl</span><span class="p">(</span>
    <span class="n">vec_e</span><span class="o">=</span><span class="n">prognostic_state</span><span class="o">.</span><span class="n">vn</span><span class="p">,</span>
    <span class="n">geofac_rot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_state</span><span class="o">.</span><span class="n">geofac_rot</span><span class="p">,</span>
    <span class="n">rot_vec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_vertex_lateral_boundary_level_2</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_vertex_halo</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">offset_providers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</details><hr></section>
<section id="self-compute-tangential-wind">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._compute_tangential_wind</span></code><a class="headerlink" href="#self-compute-tangential-wind" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>vt: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\vt{\n}{\e}{\k} = \sum_{\offProv{e2c2e}} \Wrbf\,\vn{\n}{\e}{\k}
\]</div>

Compute the tangential velocity by RBF interpolation from four neighboring
edges (diamond shape) projected along the tangential direction.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Wrbf\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.interpolation_state.}}}\)</span>rbf_vec_coeff_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">E2C2E],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\vn{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{prognostic_state.}}}\)</span>vn: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
</ul>
</details><details class="summary-offset-providers">
<summary>Offset providers</summary><img alt="e2c2e" class="offset-provider-img" src="_images/offsetProvider_e2c2e.png" />
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_tangential_wind</span><span class="p">(</span>
    <span class="n">vn</span><span class="o">=</span><span class="n">prognostic_state</span><span class="o">.</span><span class="n">vn</span><span class="p">,</span>
    <span class="n">rbf_vec_coeff_e</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_state</span><span class="o">.</span><span class="n">rbf_vec_coeff_e</span><span class="p">,</span>
    <span class="n">vt</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">vt</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_edge_lateral_boundary_level_5</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_edge_halo_level_2</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">offset_providers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</details><hr></section>
<section id="self-interpolate-vn-to-ie-and-compute-ekin-on-edges">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._interpolate_vn_to_ie_and_compute_ekin_on_edges</span></code><a class="headerlink" href="#self-interpolate-vn-to-ie-and-compute-ekin-on-edges" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>vn_ie: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\vn{\n}{\e}{\k-1/2} = \Wlev\,\vn{\n}{\e}{\k} + (1 - \Wlev) \vn{\n}{\e}{\k-1}, \quad \k \in [1, \nlev)
\]</div>

Interpolate the normal velocity from full to half levels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>z_kin_hor_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\kinehori{\n}{\e}{\k} = \frac{1}{2} \left( \vn{\n}{\e}{\k}^2 + \vt{\n}{\e}{\k}^2 \right), \quad \k \in [1, \nlev)
\]</div>

Compute the horizontal kinetic energy. Exclude the first full level.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Wlev\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.metric_state.}}}\)</span>wgtfac_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\vn{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{prognostic_state.}}}\)</span>vn: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\vt{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>vt: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
</ul>
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolate_vn_to_ie_and_compute_ekin_on_edges</span><span class="p">(</span>
    <span class="n">wgtfac_e</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_state</span><span class="o">.</span><span class="n">wgtfac_e</span><span class="p">,</span>
    <span class="n">vn</span><span class="o">=</span><span class="n">prognostic_state</span><span class="o">.</span><span class="n">vn</span><span class="p">,</span>
    <span class="n">vt</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">vt</span><span class="p">,</span>
    <span class="n">vn_ie</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">vn_ie</span><span class="p">,</span>
    <span class="n">z_kin_hor_e</span><span class="o">=</span><span class="n">z_kin_hor_e</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_edge_lateral_boundary_level_5</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_edge_halo_level_2</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">offset_providers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</details><hr></section>
<section id="self-fused-stencils-4-5">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._fused_stencils_4_5</span></code><a class="headerlink" href="#self-fused-stencils-4-5" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>z_w_concorr_me: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\wcc{\n}{\e}{\k} = \vn{\n}{\e}{\k} \pdxn{z} + \vt{\n}{\e}{\k} \pdxt{z}, \quad \k \in [\nflatlev, \nlev)
\]</div>

Compute the contravariant correction to the vertical wind due to
terrain-following coordinate. <span class="math notranslate nohighlight">\(\pdxn{}\)</span> and <span class="math notranslate nohighlight">\(\pdxt{}\)</span> are the
horizontal derivatives along the normal and tangent directions
respectively (eq. 17 in <a class="reference external" href="https://doi.org/10.1002/qj.2378">Zangl_etal_2015</a>).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>vn_ie: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\vn{\n}{\e}{-1/2} = \vn{\n}{\e}{0}
\]</div>

Set the normal wind at model top equal to the normal wind at the
first full level.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>z_vt_ie: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\vt{\n}{\e}{-1/2} = \vt{\n}{\e}{0}
\]</div>

Set the tangential wind at model top equal to the tangential wind
at the first full level.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>z_kin_hor_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\kinehori{\n}{\e}{0} = \frac{1}{2} \left( \vn{\n}{\e}{0}^2 + \vt{\n}{\e}{0}^2 \right)
\]</div>

Compute the horizontal kinetic energy on the first full level.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\vn{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{prognostic_state.}}}\)</span>vn: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\vt{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>vt: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\pdxn{z}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.metric_state.}}}\)</span>ddxn_z_full: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\pdxt{z}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.metric_state.}}}\)</span>ddxt_z_full: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></p></li>
</ul>
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_fused_stencils_4_5</span><span class="p">(</span>
    <span class="n">vn</span><span class="o">=</span><span class="n">prognostic_state</span><span class="o">.</span><span class="n">vn</span><span class="p">,</span>
    <span class="n">vt</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">vt</span><span class="p">,</span>
    <span class="n">vn_ie</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">vn_ie</span><span class="p">,</span>
    <span class="n">z_vt_ie</span><span class="o">=</span><span class="n">z_vt_ie</span><span class="p">,</span>
    <span class="n">z_kin_hor_e</span><span class="o">=</span><span class="n">z_kin_hor_e</span><span class="p">,</span>
    <span class="n">ddxn_z_full</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_state</span><span class="o">.</span><span class="n">ddxn_z_full</span><span class="p">,</span>
    <span class="n">ddxt_z_full</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_state</span><span class="o">.</span><span class="n">ddxt_z_full</span><span class="p">,</span>
    <span class="n">z_w_concorr_me</span><span class="o">=</span><span class="n">z_w_concorr_me</span><span class="p">,</span>
    <span class="n">k_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_field</span><span class="p">,</span>
    <span class="n">nflatlev_startindex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vertical_params</span><span class="o">.</span><span class="n">nflatlev</span><span class="p">,</span>
    <span class="n">nlev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_edge_lateral_boundary_level_5</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_edge_halo_level_2</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="p">{},</span>
<span class="p">)</span>
</pre></div>
</div>
</details><hr></section>
<section id="self-interpolate-to-cell-center">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._interpolate_to_cell_center</span></code><a class="headerlink" href="#self-interpolate-to-cell-center" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>z_ekinh: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\kinehori{\n}{\c}{\k} = \sum_{\offProv{c2e}} \Whor \kinehori{\n}{\e}{\k}
\]</div>

Interpolate the horizonal kinetic energy from edge to cell center.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Whor\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.interpolation_state.}}}\)</span>e_bln_c_s: <code class="docutils literal notranslate"><span class="pre">Field[Dims[CE],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\kinehori{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> z_kin_hor_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
</ul>
</details><details class="summary-offset-providers">
<summary>Offset providers</summary><img alt="c2e" class="offset-provider-img" src="_images/offsetProvider_c2e.png" />
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolate_to_cell_center</span><span class="p">(</span>
    <span class="n">interpolant</span><span class="o">=</span><span class="n">z_kin_hor_e</span><span class="p">,</span>
    <span class="n">e_bln_c_s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_state</span><span class="o">.</span><span class="n">e_bln_c_s</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_ekinh</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_cell_lateral_boundary_level_4</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_cell_halo</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">offset_providers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</details><hr></section>
<section id="self-fused-stencils-9-10">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._fused_stencils_9_10</span></code><a class="headerlink" href="#self-fused-stencils-9-10" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>z_w_concorr_mc: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\wcc{\n}{\c}{\k} = \sum_{\offProv{c2e}} \Whor \wcc{\n}{\e}{\k}
\]</div>

Interpolate the contravariant correction from edge to cell center.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>w_concorr_c: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
\wcc{\n}{\c}{\k-1/2} = \Wlev\,\wcc{\n}{\c}{\k} + (1 - \Wlev) \wcc{\n}{\c}{\k-1}, \quad \k \in [\nflatlev+1, \nlev)
\]</div>

Interpolate the contravariant correction from full to half levels.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\wcc{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> z_w_concorr_me: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\Whor\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.interpolation_state.}}}\)</span>e_bln_c_s: <code class="docutils literal notranslate"><span class="pre">Field[Dims[CE],</span> <span class="pre">float]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\Wlev\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.metric_state.}}}\)</span>wgtfac_c: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></p></li>
</ul>
</details><details class="summary-offset-providers">
<summary>Offset providers</summary><img alt="c2e" class="offset-provider-img" src="_images/offsetProvider_c2e.png" />
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_fused_stencils_9_10</span><span class="p">(</span>
    <span class="n">z_w_concorr_me</span><span class="o">=</span><span class="n">z_w_concorr_me</span><span class="p">,</span>
    <span class="n">e_bln_c_s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_state</span><span class="o">.</span><span class="n">e_bln_c_s</span><span class="p">,</span>
    <span class="n">local_z_w_concorr_mc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_w_concorr_mc</span><span class="p">,</span>
    <span class="n">wgtfac_c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_state</span><span class="o">.</span><span class="n">wgtfac_c</span><span class="p">,</span>
    <span class="n">w_concorr_c</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">w_concorr_c</span><span class="p">,</span>
    <span class="n">k_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_field</span><span class="p">,</span>
    <span class="n">nflatlev_startindex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vertical_params</span><span class="o">.</span><span class="n">nflatlev</span><span class="p">,</span>
    <span class="n">nlev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_cell_lateral_boundary_level_4</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_cell_halo</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">offset_providers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</details><hr></section>
<section id="self-fused-stencils-11-to-13">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._fused_stencils_11_to_13</span></code><a class="headerlink" href="#self-fused-stencils-11-to-13" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>z_w_con_c: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[\begin{split}
(\w{\n}{\c}{\k-1/2} - \wcc{\n}{\c}{\k-1/2}) =
\begin{cases}
&amp;     \w{\n}{\c}{\k-1/2},                        &amp; \k \in [0, \nflatlev+1)     \\[3pt]
&amp;     \w{\n}{\c}{\k-1/2} - \wcc{\n}{\c}{\k-1/2}, &amp; \k \in [\nflatlev+1, \nlev) \\[3pt]
&amp;     0,                                         &amp; \k = \nlev
\end{cases}
\end{split}\]</div>

Subtract the contravariant correction <span class="math notranslate nohighlight">\(\wcc{}{}{}\)</span> from the
vertical wind <span class="math notranslate nohighlight">\(\w{}{}{}\)</span> in the terrain-following levels. This is
done for convevnience here, instead of directly in the advection
tendency update, because the result needs to be interpolated to
edge centers and full levels for later use.
The papers do not use a new symbol for this variable, and the code
ambiguosly mixes the variable names used for
<span class="math notranslate nohighlight">\(\wcc{}{}{}\)</span> and <span class="math notranslate nohighlight">\((\w{}{}{} - \wcc{}{}{})\)</span>.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\w{\n}{\c}{\k\pm1/2}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{prognostic_state.}}}\)</span>w: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\wcc{\n}{\c}{\k\pm1/2}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>w_concorr_c: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float]</span></code></p></li>
</ul>
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_fused_stencils_11_to_13</span><span class="p">(</span>
    <span class="n">w</span><span class="o">=</span><span class="n">prognostic_state</span><span class="o">.</span><span class="n">w</span><span class="p">,</span>
    <span class="n">w_concorr_c</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">w_concorr_c</span><span class="p">,</span>
    <span class="n">local_z_w_con_c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_w_con_c</span><span class="p">,</span>
    <span class="n">k_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_field</span><span class="p">,</span>
    <span class="n">nflatlev_startindex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vertical_params</span><span class="o">.</span><span class="n">nflatlev</span><span class="p">,</span>
    <span class="n">nlev</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_cell_lateral_boundary_level_4</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_cell_halo</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="p">{},</span>
<span class="p">)</span>
</pre></div>
</div>
</details><hr></section>
<section id="self-interpolate-contravariant-vertical-velocity-to-full-levels">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._interpolate_contravariant_vertical_velocity_to_full_levels</span></code><a class="headerlink" href="#self-interpolate-contravariant-vertical-velocity-to-full-levels" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>z_w_con_c_full: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></dt><dd><p><div class="math notranslate nohighlight">
\[
(\w{\n}{\c}{\k} - \wcc{\n}{\c}{\k}) = \frac{1}{2} [ (\w{\n}{\c}{\k-1/2} - \wcc{\n}{\c}{\k-1/2})
+ (\w{\n}{\c}{\k+1/2} - \wcc{\n}{\c}{\k+1/2}) ]
\]</div>

Interpolate the vertical wind with contravariant correction from
half to full levels.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\((\w{\n}{\c}{\k\pm1/2} - \wcc{\n}{\c}{\k\pm1/2})\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>z_w_con_c: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
</ul>
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_interpolate_contravariant_vertical_velocity_to_full_levels</span><span class="p">(</span>
    <span class="n">z_w_con_c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_w_con_c</span><span class="p">,</span>
    <span class="n">z_w_con_c_full</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_w_con_c_full</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_cell_lateral_boundary_level_4</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_cell_halo</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">offset_providers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</details><hr></section>
<section id="self-compute-advective-normal-wind-tendency">
<h2><code class="xref py py-meth docutils literal notranslate"><span class="pre">self._compute_advective_normal_wind_tendency</span></code><a class="headerlink" href="#self-compute-advective-normal-wind-tendency" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>Outputs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>ddt_vn_apc_pc[ntnd]</dt><dd><p><div class="math notranslate nohighlight">
\[\begin{split}
&amp; \advvn{\n}{\e}{\k} &amp;&amp;= \pdxn{\kinehori{}{}{}} + \vt{}{}{} (\vortvert{}{}{} + \coriolis{}) + \pdz{\vn{}{}{}} (\w{}{}{} - \wcc{}{}{}) \\[3pt]
&amp;                    &amp;&amp;= \Gradn_{\offProv{e2c}} \Cgrad \kinehori{\n}{c}{\k} + \kinehori{\n}{\e}{\k} \Gradn_{\offProv{e2c}} \Cgrad     \\[3pt]
&amp;                    &amp;&amp;+ \vt{\n}{\e}{\k} (\coriolis{\e} + 1/2 \sum_{\offProv{e2v}} \vortvert{\n}{\v}{\k})                             \\[3pt]
&amp;                    &amp;&amp;+ \frac{\vn{\n}{\e}{\k-1/2} - \vn{\n}{\e}{\k+1/2}}{\Dz{k}}
\sum_{\offProv{e2c}} \Whor (\w{\n}{\c}{\k} - \wcc{\n}{\c}{\k})
\end{split}\]</div>

Compute the advective tendency of the normal wind (eq. 13 in
<a class="reference external" href="https://doi.org/10.1002/qj.2378">Zangl_etal_2015</a>).
The edge-normal derivative of the kinetic energy is computed by
combining the first order approximation across adiacent cell
centres (eq. 7 in <a class="reference external" href="https://doi.org/10.1175/MWR2986.1">Bonaventura_and_Ringler_2005</a>) with the edge value of
the kinetic energy (TODO: this needs explaining and a reference).</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<details class="summary-inputs">
<summary>Inputs</summary><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Cgrad\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.metric_state.}}}\)</span>coeff_gradekin: <code class="docutils literal notranslate"><span class="pre">Field[Dims[EC],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\kinehori{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> z_kin_hor_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\kinehori{\n}{\c}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>z_ekinh: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\vt{\n}{\e}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>vt: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\coriolis{\e}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.edge_params.}}}\)</span>f_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\vortvert{\n}{\v}{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>zeta: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Vertex,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\Whor\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.interpolation_state.}}}\)</span>c_lin_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">E2C],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\((\w{\n}{\c}{\k} - \wcc{\n}{\c}{\k})\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.}}}\)</span>z_w_con_c_full: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Cell,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\vn{\n}{\e}{\k\pm1/2}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{diagnostic_state.}}}\)</span>vn_ie: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
<li><p><span class="math notranslate nohighlight">\(\Dz{\k}\)</span> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <span class="math notranslate nohighlight">\(\color{grey}{\scriptstyle{\texttt{self.metric_state.}}}\)</span>ddqz_z_full_e: <code class="docutils literal notranslate"><span class="pre">Field[Dims[Edge,</span> <span class="pre">K],</span> <span class="pre">float64]</span></code></p></li>
</ul>
</details><details class="summary-offset-providers">
<summary>Offset providers</summary><img alt="e2c" class="offset-provider-img" src="_images/offsetProvider_e2c.png" />
<img alt="e2v" class="offset-provider-img" src="_images/offsetProvider_e2v.png" />
</details><details class="summary-source-code">
<summary>Source code</summary><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_advective_normal_wind_tendency</span><span class="p">(</span>
    <span class="n">z_kin_hor_e</span><span class="o">=</span><span class="n">z_kin_hor_e</span><span class="p">,</span>
    <span class="n">coeff_gradekin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_state</span><span class="o">.</span><span class="n">coeff_gradekin</span><span class="p">,</span>
    <span class="n">z_ekinh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_ekinh</span><span class="p">,</span>
    <span class="n">zeta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">,</span>
    <span class="n">vt</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">vt</span><span class="p">,</span>
    <span class="n">f_e</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_params</span><span class="o">.</span><span class="n">f_e</span><span class="p">,</span>
    <span class="n">c_lin_e</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_state</span><span class="o">.</span><span class="n">c_lin_e</span><span class="p">,</span>
    <span class="n">z_w_con_c_full</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z_w_con_c_full</span><span class="p">,</span>
    <span class="n">vn_ie</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">vn_ie</span><span class="p">,</span>
    <span class="n">ddqz_z_full_e</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_state</span><span class="o">.</span><span class="n">ddqz_z_full_e</span><span class="p">,</span>
    <span class="n">ddt_vn_apc</span><span class="o">=</span><span class="n">diagnostic_state</span><span class="o">.</span><span class="n">ddt_vn_apc_pc</span><span class="o">.</span><span class="n">predictor</span><span class="p">,</span>
    <span class="n">horizontal_start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_edge_nudging_level_2</span><span class="p">,</span>
    <span class="n">horizontal_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_edge_local</span><span class="p">,</span>
    <span class="n">vertical_start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">vertical_end</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">num_levels</span><span class="p">,</span>
    <span class="n">offset_provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">offset_providers</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</details></section>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dycore_numerics.html" class="btn btn-neutral float-left" title="Dycore numerical documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dycore_numerics_nonhydro.html" class="btn btn-neutral float-right" title="Dycore numerical documentation (solve nonhydro)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, C2SM.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
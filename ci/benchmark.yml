include:
  - local: 'ci/base.yml'

variables:
  DACE_VERSION: "0.15.1"

build:
  extends: .build_template

benchmark_model_icon_grid:
  extends: .test_template
  stage: benchmark
  script:
    - if [ "$BACKEND" = "dace_cpu" ] || [ "$BACKEND" = "dace_gpu" ]; then pip install dace==$DACE_VERSION; fi
    - tox -r -e run_benchmarks -c model/ --verbose --benchmark-min-rounds=1 -- --backend=$BACKEND --grid=icon_grid
  parallel:
    matrix:
      - BACKEND: [dace_cpu, dace_gpu, gtfn_cpu, gtfn_gpu]

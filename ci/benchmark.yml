include:
  - local: 'ci/base.yml'

.benchmark_model_stencils:
  stage: benchmark
  variables:
    CODSPEED_RUNNER_VERSION: 3.2.0
  script:
    - echo "INSTALLING CODSPEED"
    - curl -fsSL https://github.com/CodSpeedHQ/runner/releases/download/v$CODSPEED_RUNNER_VERSION/codspeed-runner-installer.sh | bash -s
    - source $HOME/.cargo/env
    - which codspeed
    - ls -l $HOME/.cargo/bin
    - export PATH=$HOME/.cargo/bin:$PATH
    - echo "CHECK PATH FOR CODSPEED"
    - echo $PATH
    - codspeed run -- nox -s benchmark_model-3.10  -- --backend=$BACKEND --grid=$GRID
  parallel:
    matrix:
      - BACKEND: [gtfn_cpu, gtfn_gpu]
        GRID: [icon_grid, icon_grid_global]
# benchmark_model_stencils_x86_64:
#   extends: [.benchmark_model_stencils, .test_template_x86_64]
benchmark_model_stencils_aarch64:
  extends: [.benchmark_model_stencils, .test_template_aarch64]

include:
  - local: 'ci/base.yml'

.benchmark_model_base_variables:
  variables:
    ICON4PY_ENABLE_GRID_DOWNLOAD: false
    ICON4PY_ENABLE_TESTDATA_DOWNLOAD: false
    GT4PY_UNSTRUCTURED_HORIZONTAL_HAS_UNIT_STRIDE: true
    PYTHONOPTIMIZE: 2

.benchmark_model_stencils:
  stage: benchmark
  script:
    - nox -s __bencher_baseline_CI-3.10 -- --backend=$BACKEND --grid=$GRID -k "test_Test and compile_time_domain"
  parallel:
    matrix:
      - BACKEND: [dace_cpu, dace_gpu, gtfn_cpu, gtfn_gpu]
        GRID: [icon_benchmark_regional, icon_benchmark_global]
  extends: [.benchmark_model_base_variables]
  variables:
    GT4PY_COLLECT_METRICS_LEVEL: 10

.benchmark_model_granules:
  stage: benchmark
  script:
    - nox -s __bencher_baseline_CI-3.10 -- --backend=$BACKEND --grid=$GRID -k "test_diffusion_benchmark"
  parallel:
    matrix:
      - BACKEND: [dace_cpu, dace_gpu, gtfn_cpu, gtfn_gpu]
        GRID: [icon_benchmark_regional, icon_benchmark_global]
  extends: [.benchmark_model_base_variables]

# benchmark_bencher_baseline_x86_64:
#   extends: [.benchmark_model_stencils, .test_template_x86_64]

benchmark_bencher_stencils_baseline_aarch64:
  extends: [.benchmark_model_stencils, .test_template_aarch64]

benchmark_bencher_granules_baseline_aarch64:
  extends: [.benchmark_model_granules, .test_template_aarch64]
